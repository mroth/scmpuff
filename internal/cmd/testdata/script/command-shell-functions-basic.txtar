# Scenario: shell wrapper propagates status errors and basic clean status behavior
# Original Cucumber Source: features/shell_functions.feature
# Purpose: Verify scmpuff_status preserves error/exit contracts and basic clean repo output.
# Verbose notes: Covers 'outside-repo' and 'basic functionality' scenarios across bash/zsh/fish.

# Case: Handle error conditions from wrapped binary command (outside repo)
[exec:bash] exec bash -lc 'eval "$(scmpuff init -s)"; scmpuff_status; test $? -eq 128'
[exec:bash] stderr 'Not a git repository \(or any of the parent directories\)'

[exec:zsh] exec zsh -lc 'eval "$(scmpuff init -s)"; scmpuff_status; test $? -eq 128'
[exec:zsh] stderr 'Not a git repository \(or any of the parent directories\)'

[exec:fish] exec fish -c 'scmpuff init --shell=fish | source; scmpuff_status; test $status -eq 128'
[exec:fish] stderr 'Not a git repository \(or any of the parent directories\)'

# Case: Basic functionality works with shell wrapper in clean git repo
exec git init repo_clean
cd repo_clean
exec git add keep.txt
exec git commit -m base

# Bash
[exec:bash] exec bash -lc 'eval "$(scmpuff init -s)"; scmpuff_status'
[exec:bash] stdout 'No changes \(working directory clean\)'

# Zsh
[exec:zsh] exec zsh -lc 'eval "$(scmpuff init -s)"; scmpuff_status'
[exec:zsh] stdout 'No changes \(working directory clean\)'

# Fish
[exec:fish] exec fish -c 'scmpuff init --shell=fish | source; scmpuff_status'
[exec:fish] stdout 'No changes \(working directory clean\)'

-- repo_clean/keep.txt --
keep
